<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <!-- Meta tag for responsive design -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø–æ –≥–µ–æ–º–µ—Ç—Ä–∏–∏: –ß–µ—Ç—ã—Ä–µ—Ö—É–≥–æ–ª—å–Ω–∏–∫–∏</title>
    <!-- Optimized Tailwind CSS from a static CDN -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <!-- KaTeX for rendering mathematical formulas -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <!-- DEFER attribute added to scripts to prevent render blocking -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
        /* Using fast, native system fonts instead of Google Fonts */
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
        }
        .katex-display {
            margin: 0;
        }
    </style>
</head>
<body class="bg-slate-100 flex items-center justify-center min-h-screen p-4">

    <!-- Start Screen -->
    <div id="start-container" class="bg-white w-full max-w-2xl rounded-2xl shadow-lg p-6 sm:p-8 text-center">
        <h2 class="text-2xl sm:text-3xl font-bold text-slate-800 mb-4">–¢–µ—Å—Ç –ø–æ –≥–µ–æ–º–µ—Ç—Ä–∏–∏</h2>
        <p class="text-base sm:text-lg text-slate-600 mb-6">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.</p>
        <div class="space-y-4 mb-8">
            <input type="text" id="first-name" placeholder="–ò–º—è" class="w-full text-center text-lg border-2 border-slate-300 rounded-lg p-3 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none">
            <input type="text" id="last-name" placeholder="–§–∞–º–∏–ª–∏—è" class="w-full text-center text-lg border-2 border-slate-300 rounded-lg p-3 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none">
            <p id="name-error" class="text-red-500 text-sm hidden">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±–∞ –ø–æ–ª—è.</p>
        </div>
        <button id="start-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-transform transform hover:scale-105">
            –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç
        </button>
    </div>

    <!-- Quiz Screen -->
    <div id="quiz-container" class="bg-white w-full max-w-2xl rounded-2xl shadow-lg p-6 md:p-8 transition-all duration-300 hidden">
        <!-- Header and Progress Bar -->
        <div id="quiz-header" class="mb-6">
            <div class="flex flex-wrap justify-between items-center gap-y-2 mb-2">
                <h1 class="text-xl sm:text-2xl font-bold text-slate-800">–ì–µ–æ–º–µ—Ç—Ä–∏—è: –ß–µ—Ç—ã—Ä–µ—Ö—É–≥–æ–ª—å–Ω–∏–∫–∏</h1>
                 <div class="flex items-center space-x-3">
                     <p id="timer" class="text-base font-bold text-slate-600 bg-slate-100 px-3 py-1 rounded-full w-[70px] text-center tracking-wider"></p>
                     <p id="progress-text" class="text-sm font-medium text-slate-500 bg-slate-100 px-3 py-1 rounded-full">–í–æ–ø—Ä–æ—Å 1 –∏–∑ 20</p>
                 </div>
            </div>
            <div class="w-full bg-slate-200 rounded-full h-2">
                <div id="progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-500" style="width: 5%;"></div>
            </div>
        </div>
        
        <!-- Question Area -->
        <div id="question-area" class="mb-6">
            <p id="question-text" class="text-lg text-slate-700 leading-relaxed min-h-[60px]"></p>
        </div>

        <!-- Answer Area -->
        <div id="answer-area" class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
            <!-- Answer buttons/inputs will be generated here -->
        </div>
        
        <!-- Feedback Area -->
        <div id="feedback-area" class="min-h-[60px] flex flex-col justify-center">
             <div id="hint-box" class="hidden cursor-pointer bg-slate-100 p-3 rounded-lg text-slate-600 text-sm">
                <span class="font-semibold">üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</span> <span id="hint-text"></span>
            </div>
            <div id="result-text" class="text-center font-semibold text-lg p-2 rounded-md"></div>
        </div>

        <!-- Next Button -->
        <div class="mt-6 flex justify-end">
            <button id="next-btn" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-transform transform hover:scale-105 hidden">
                –î–∞–ª–µ–µ
            </button>
        </div>
    </div>

    <!-- Results Screen -->
    <div id="results-container" class="hidden bg-white w-full max-w-2xl rounded-2xl shadow-lg p-6 sm:p-8 text-center">
        <h2 id="user-name-result" class="text-2xl sm:text-3xl font-bold text-slate-800 mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
        <div class="relative w-40 h-40 mx-auto mb-6 flex items-center justify-center">
            <svg class="w-full h-full" viewBox="0 0 36 36">
                <path class="stroke-current text-slate-200" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke-width="4"></path>
                <path id="result-circle" class="stroke-current text-blue-600" stroke-width="4" stroke-linecap="round" stroke-dasharray="0, 100" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
            </svg>
            <span id="score-percentage" class="absolute text-3xl sm:text-4xl font-bold text-slate-800">0%</span>
        </div>
        <div class="flex justify-around items-center mb-8 bg-slate-50 p-4 rounded-lg">
             <div>
                <p class="text-slate-500 text-sm font-medium">–ë–ê–õ–õ–´</p>
                <p id="score-text" class="text-2xl sm:text-3xl font-bold text-slate-800">0/20</p>
             </div>
             <div>
                <p class="text-slate-500 text-sm font-medium">–û–¶–ï–ù–ö–ê</p>
                <p id="grade-text" class="text-2xl sm:text-3xl font-bold text-slate-800">-</p>
             </div>
        </div>
        <p id="result-message" class="text-lg sm:text-xl font-medium text-slate-700 mb-8"></p>
        <p id="saving-status" class="text-sm text-slate-500 mb-4"></p>
        <button id="restart-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-transform transform hover:scale-105">
            –ü—Ä–æ–π—Ç–∏ –µ—â–µ —Ä–∞–∑
        </button>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
    
        const onKatexLoad = () => {
             // This function waits for KaTeX to be loaded and then renders math formulas.
             if (window.renderMathInElement) {
                renderMathInElement(document.body, {
                    delimiters: [
                      {left: '$$', right: '$$', display: true},
                      {left: '$', right: '$', display: false}
                    ],
                    throwOnError: false
                });
             } else {
                // If KaTeX is not loaded yet, check again in 50ms.
                setTimeout(onKatexLoad, 50);
             }
        };

        // --- IMPORTANT: Paste your Google Apps Script Web App URL here ---
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxhzY5vNdZUdmlhAu0BOM6mEEcBXl0-XFKTRL7w_vQRfRL2V3irpna5Q1VxgpI1f5BSKQ/exec'; // Example: 'https://script.google.com/macros/s/YOUR_ID/exec'

        const quizData = [
            {
                "questionNumber": 1,
                "questionType": "FREE_RESPONSE",
                "question": "–ß–µ–º—É —Ä–∞–≤–Ω–∞ —Å—É–º–º–∞ —É–≥–ª–æ–≤ –≤—ã–ø—É–∫–ª–æ–≥–æ —á–µ—Ç—ã—Ä–µ—Ö—É–≥–æ–ª—å–Ω–∏–∫–∞ (–≤ –≥—Ä–∞–¥—É—Å–∞—Ö)?",
                "correctAnswers": ["360"],
                "hint": "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–æ–≤–µ—Å—Ç–∏ –¥–∏–∞–≥–æ–Ω–∞–ª—å –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –Ω–∞ –∫–∞–∫–∏–µ —Ñ–∏–≥—É—Ä—ã –æ–Ω–∞ –¥–µ–ª–∏—Ç —á–µ—Ç—ã—Ä–µ—Ö—É–≥–æ–ª—å–Ω–∏–∫.",
                "rationale": "–õ—é–±–æ–π –≤—ã–ø—É–∫–ª—ã–π —á–µ—Ç—ã—Ä–µ—Ö—É–≥–æ–ª—å–Ω–∏–∫ –º–æ–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –¥–∏–∞–≥–æ–Ω–∞–ª—å—é –Ω–∞ –¥–≤–∞ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞, —Å—É–º–º–∞ —É–≥–ª–æ–≤ –≤ –∫–∞–∂–¥–æ–º –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Ä–∞–≤–Ω–∞ $180¬∞$. –ò—Ç–æ–≥–æ: $180¬∞ \\times 2 = 360¬∞$."
            },
            {
                "questionNumber": 2,
                "question": "–ß–µ—Ç—ã—Ä–µ—Ö—É–≥–æ–ª—å–Ω–∏–∫, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –ø–æ–ø–∞—Ä–Ω–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã, –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è...",
                "answerOptions": [
                    { "text": "–¢—Ä–∞–ø–µ—Ü–∏—è", "isCorrect": false },
                    { "text": "–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫", "isCorrect": false },
                    { "text": "–ü–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º", "isCorrect": true },
                    { "text": "–†–æ–º–±", "isCorrect": false }
                ],
                "hint": "–í—Å–ø–æ–º–Ω–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –Ω–∞–∑–≤–∞–Ω–∏—è –¥—Ä—É–≥–∏—Ö —Ñ–∏–≥—É—Ä."
            },
            {
                "questionNumber": 3,
                "question": "–û–¥–∏–Ω –∏–∑ —É–≥–ª–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º–∞ —Ä–∞–≤–µ–Ω $45¬∞$. –ß–µ–º—É —Ä–∞–≤–Ω—ã –æ—Å—Ç–∞–ª—å–Ω—ã–µ –µ–≥–æ —É–≥–ª—ã?",
                "answerOptions": [
                    { "text": "$45¬∞, 45¬∞, 45¬∞$", "isCorrect": false },
                    { "text": "$135¬∞, 45¬∞, 135¬∞$", "isCorrect": true },
                    { "text": "$45¬∞, 90¬∞, 90¬∞$", "isCorrect": false },
                    { "text": "$135¬∞, 135¬∞, 135¬∞$", "isCorrect": false }
                ],
                "hint": "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–π—Å—Ç–≤–∞ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã—Ö –∏ —Å–æ—Å–µ–¥–Ω–∏—Ö —É–≥–ª–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º–∞."
            },
            {
                "questionNumber": 4,
                "question": "–î–∏–∞–≥–æ–Ω–∞–ª–∏ –∫–∞–∫–æ–≥–æ —á–µ—Ç—ã—Ä–µ—Ö—É–≥–æ–ª—å–Ω–∏–∫–∞ —Ä–∞–≤–Ω—ã, –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω—ã –∏ —Ç–æ—á–∫–æ–π –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –¥–µ–ª—è—Ç—Å—è –ø–æ–ø–æ–ª–∞–º?",
                "answerOptions": [
                    { "text": "–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞", "isCorrect": false },
                    { "text": "–†–æ–º–±–∞", "isCorrect": false },
                    { "text": "–ö–≤–∞–¥—Ä–∞—Ç–∞", "isCorrect": true },
                    { "text": "–†–∞–≤–Ω–æ–±–µ–¥—Ä–µ–Ω–Ω–æ–π —Ç—Ä–∞–ø–µ—Ü–∏–∏", "isCorrect": false }
                ],
                "hint": "–≠—Ç–∞ —Ñ–∏–≥—É—Ä–∞ —Å–æ—á–µ—Ç–∞–µ—Ç –≤ —Å–µ–±–µ —Å–≤–æ–π—Å—Ç–≤–∞ –∏ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞, –∏ —Ä–æ–º–±–∞."
            },
            {
                "questionNumber": 5,
                "questionType": "FREE_RESPONSE",
                "question": "–ü–µ—Ä–∏–º–µ—Ç—Ä —Ä–æ–º–±–∞ —Ä–∞–≤–µ–Ω 40 —Å–º. –ß–µ–º—É —Ä–∞–≤–Ω–∞ –µ–≥–æ —Å—Ç–æ—Ä–æ–Ω–∞ (–≤ —Å–º)?",
                "correctAnswers": ["10"],
                "hint": "–í—Å–ø–æ–º–Ω–∏—Ç–µ, —á—Ç–æ —Ç–∞–∫–æ–µ —Ä–æ–º–± –∏ –∫–∞–∫ —Å–≤—è–∑–∞–Ω—ã –µ–≥–æ —Å—Ç–æ—Ä–æ–Ω—ã.",
                "rationale": "–£ —Ä–æ–º–±–∞ –≤—Å–µ —á–µ—Ç—ã—Ä–µ —Å—Ç–æ—Ä–æ–Ω—ã —Ä–∞–≤–Ω—ã, –ø–æ—ç—Ç–æ–º—É –ø–µ—Ä–∏–º–µ—Ç—Ä (40) –¥–µ–ª–∏—Ç—Å—è –Ω–∞ 4, —á—Ç–æ –¥–∞–µ—Ç 10 —Å–º."
            },
            {
                "questionNumber": 6,
                "question": "–ü–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—Å–µ —É–≥–ª—ã –ø—Ä—è–º—ã–µ, –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è...",
                "answerOptions": [
                    { "text": "–ö–≤–∞–¥—Ä–∞—Ç", "isCorrect": false },
                    { "text": "–†–æ–º–±", "isCorrect": false },
                    { "text": "–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫", "isCorrect": true },
                    { "text": "–¢—Ä–∞–ø–µ—Ü–∏—è", "isCorrect": false }
                ],
                "hint": "–ù–∞–∑–≤–∞–Ω–∏–µ —ç—Ç–æ–π —Ñ–∏–≥—É—Ä—ã –≥–æ–≤–æ—Ä–∏—Ç —Å–∞–º–æ –∑–∞ —Å–µ–±—è."
            },
            {
                "questionNumber": 7,
                "questionType": "FREE_RESPONSE",
                "question": "–ü–µ—Ä–∏–º–µ—Ç—Ä –ø–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º–∞ —Ä–∞–≤–µ–Ω 48 —Å–º. –û–¥–Ω–∞ —Å—Ç–æ—Ä–æ–Ω–∞ –≤ 3 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ –¥—Ä—É–≥–æ–π. –ù–∞–π–¥–∏—Ç–µ –±–æ–ª—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É –ø–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º–∞ (–≤ —Å–º).",
                "correctAnswers": ["18"],
                "hint": "–ü–µ—Ä–∏–º–µ—Ç—Ä –ø–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º–∞ —Ä–∞–≤–µ–Ω $2(a+b)$. –ü—É—Å—Ç—å –º–µ–Ω—å—à–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ x.",
                "rationale": "–ü–æ–ª—É–ø–µ—Ä–∏–º–µ—Ç—Ä (—Å—É–º–º–∞ —Å–º–µ–∂–Ω—ã—Ö —Å—Ç–æ—Ä–æ–Ω) —Ä–∞–≤–µ–Ω $48/2 = 24$ —Å–º. –ü—É—Å—Ç—å –æ–¥–Ω–∞ —Å—Ç–æ—Ä–æ–Ω–∞ $x$, —Ç–æ–≥–¥–∞ –¥—Ä—É–≥–∞—è $3x$. $x + 3x = 24 \\Rightarrow 4x = 24 \\Rightarrow x = 6$. –ë–æ–ª—å—à–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ —Ä–∞–≤–Ω–∞ $3x = 3 \\times 6 = 18$ —Å–º."
            },
            {
                "questionNumber": 8,
                "question": "–ï—Å–ª–∏ –≤ –ø–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º–µ –¥–∏–∞–≥–æ–Ω–∞–ª–∏ –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω—ã, —Ç–æ —ç—Ç–æ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º —è–≤–ª—è–µ—Ç—Å—è...",
                "answerOptions": [
                    { "text": "–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–º", "isCorrect": false },
                    { "text": "–†–æ–º–±–æ–º", "isCorrect": true },
                    { "text": "–õ—é–±—ã–º –ø–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º–æ–º", "isCorrect": false },
                    { "text": "–¢—Ä–∞–ø–µ—Ü–∏–µ–π", "isCorrect": false }
                ],
                "hint": "–í—Å–ø–æ–º–Ω–∏—Ç–µ –æ—Å–æ–±—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –¥–∏–∞–≥–æ–Ω–∞–ª–µ–π —Ä–∞–∑–Ω—ã—Ö –≤–∏–¥–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º–æ–≤."
            },
            {
                "questionNumber": 9,
                "question": "–í —Ä–∞–≤–Ω–æ–±–µ–¥—Ä–µ–Ω–Ω–æ–π —Ç—Ä–∞–ø–µ—Ü–∏–∏ –æ–¥–∏–Ω –∏–∑ —É–≥–ª–æ–≤ —Ä–∞–≤–µ–Ω $60¬∞$. –ß–µ–º—É —Ä–∞–≤–Ω—ã –æ—Å—Ç–∞–ª—å–Ω—ã–µ —É–≥–ª—ã?",
                "answerOptions": [
                    { "text": "$60¬∞, 60¬∞, 60¬∞$", "isCorrect": false },
                    { "text": "$60¬∞, 120¬∞, 120¬∞$", "isCorrect": true },
                    { "text": "$60¬∞, 90¬∞, 150¬∞$", "isCorrect": false },
                    { "text": "$120¬∞, 120¬∞, 120¬∞$", "isCorrect": false }
                ],
                "hint": "–£ —Ä–∞–≤–Ω–æ–±–µ–¥—Ä–µ–Ω–Ω–æ–π —Ç—Ä–∞–ø–µ—Ü–∏–∏ —É–≥–ª—ã –ø—Ä–∏ –æ—Å–Ω–æ–≤–∞–Ω–∏—è—Ö —Ä–∞–≤–Ω—ã."
            },
            {
                "questionNumber": 10,
                "questionType": "FREE_RESPONSE",
                "question": "–î–∏–∞–≥–æ–Ω–∞–ª–∏ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ ABCD –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è –≤ —Ç–æ—á–∫–µ O. –ù–∞–π–¥–∏—Ç–µ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞ AOB, –µ—Å–ª–∏ –¥–∏–∞–≥–æ–Ω–∞–ª—å AC —Ä–∞–≤–Ω–∞ 14 —Å–º, –∞ —Å—Ç–æ—Ä–æ–Ω–∞ AB —Ä–∞–≤–Ω–∞ 9 —Å–º.",
                "correctAnswers": ["23"],
                "hint": "–í—Å–ø–æ–º–Ω–∏—Ç–µ, –∫–∞–∫–∏–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏ –æ–±–ª–∞–¥–∞—é—Ç –¥–∏–∞–≥–æ–Ω–∞–ª–∏ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞.",
                "rationale": "–î–∏–∞–≥–æ–Ω–∞–ª–∏ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ —Ä–∞–≤–Ω—ã –∏ —Ç–æ—á–∫–æ–π –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –¥–µ–ª—è—Ç—Å—è –ø–æ–ø–æ–ª–∞–º. –ó–Ω–∞—á–∏—Ç, AO = BO = 14/2 = 7 —Å–º. –ü–µ—Ä–∏–º–µ—Ç—Ä —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞ AOB —Ä–∞–≤–µ–Ω AO + BO + AB = 7 + 7 + 9 = 23 —Å–º."
            },
            {
                "questionNumber": 11,
                "question": "–ö–∞–∫–æ–µ –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –Ω–µ–≤–µ—Ä–Ω–æ?",
                "answerOptions": [
                    { "text": "–õ—é–±–æ–π –∫–≤–∞–¥—Ä–∞—Ç —è–≤–ª—è–µ—Ç—Å—è —Ä–æ–º–±–æ–º.", "isCorrect": false },
                    { "text": "–õ—é–±–æ–π —Ä–æ–º–± —è–≤–ª—è–µ—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º–æ–º.", "isCorrect": false },
                    { "text": "–õ—é–±–æ–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ —è–≤–ª—è–µ—Ç—Å—è –∫–≤–∞–¥—Ä–∞—Ç–æ–º.", "isCorrect": true },
                    { "text": "–õ—é–±–æ–π –∫–≤–∞–¥—Ä–∞—Ç —è–≤–ª—è–µ—Ç—Å—è –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–º.", "isCorrect": false }
                ],
                "hint": "–ü–æ–¥—É–º–∞–π—Ç–µ –æ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–∏ —ç—Ç–∏—Ö —Ñ–∏–≥—É—Ä. –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ–¥–Ω–∞ —á–∞—Å—Ç–Ω—ã–º —Å–ª—É—á–∞–µ–º –¥—Ä—É–≥–æ–π?"
            },
            {
                "questionNumber": 12,
                "questionType": "FREE_RESPONSE",
                "question": "–í –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–π —Ç—Ä–∞–ø–µ—Ü–∏–∏ –æ–¥–∏–Ω –∏–∑ —É–≥–ª–æ–≤ —Ä–∞–≤–µ–Ω 130¬∞. –ù–∞–π–¥–∏—Ç–µ –Ω–∞–∏–º–µ–Ω—å—à–∏–π —É–≥–æ–ª —ç—Ç–æ–π —Ç—Ä–∞–ø–µ—Ü–∏–∏ (–≤ –≥—Ä–∞–¥—É—Å–∞—Ö).",
                "correctAnswers": ["50"],
                "hint": "–£ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–π —Ç—Ä–∞–ø–µ—Ü–∏–∏ –¥–≤–∞ —É–≥–ª–∞ –ø—Ä—è–º—ã–µ. –°—É–º–º–∞ —É–≥–ª–æ–≤ –ø—Ä–∏ –±–æ–∫–æ–≤–æ–π —Å—Ç–æ—Ä–æ–Ω–µ —Ä–∞–≤–Ω–∞ $180¬∞$.",
                "rationale": "–°—É–º–º–∞ —É–≥–ª–æ–≤ –ø—Ä–∏ –±–æ–∫–æ–≤–æ–π —Å—Ç–æ—Ä–æ–Ω–µ —Ç—Ä–∞–ø–µ—Ü–∏–∏ —Ä–∞–≤–Ω–∞ 180¬∞. $180¬∞ - 130¬∞ = 50¬∞$. –≠—Ç–æ –∏ –µ—Å—Ç—å –Ω–∞–∏–º–µ–Ω—å—à–∏–π –æ—Å—Ç—Ä—ã–π —É–≥–æ–ª, —Ç–∞–∫ –∫–∞–∫ –¥–≤–∞ –¥—Ä—É–≥–∏—Ö —É–≥–ª–∞ –ø—Ä—è–º—ã–µ (90¬∞)."
            },
            {
                "questionNumber": 13,
                "question": "–î–∏–∞–≥–æ–Ω–∞–ª—å –¥–µ–ª–∏—Ç –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –Ω–∞ –¥–≤–∞ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞. –ö–∞–∫–æ–≥–æ –≤–∏–¥–∞ —ç—Ç–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∏?",
                "answerOptions": [
                    { "text": "–†–∞–≤–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ", "isCorrect": false },
                    { "text": "–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω—ã–µ", "isCorrect": true },
                    { "text": "–¢—É–ø–æ—É–≥–æ–ª—å–Ω—ã–µ", "isCorrect": false },
                    { "text": "–†–∞–∑–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –æ—Å—Ç—Ä–æ—É–≥–æ–ª—å–Ω—ã–µ", "isCorrect": false }
                ],
                "hint": "–í—Å–ø–æ–º–Ω–∏—Ç–µ, –∫–∞–∫–∏–µ —É–≥–ª—ã —É –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞."
            },
            {
                "questionNumber": 14,
                "question": "–ï—Å–ª–∏ –¥–∏–∞–≥–æ–Ω–∞–ª–∏ —á–µ—Ç—ã—Ä–µ—Ö—É–≥–æ–ª—å–Ω–∏–∫–∞ —Ç–æ—á–∫–æ–π –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –¥–µ–ª—è—Ç—Å—è –ø–æ–ø–æ–ª–∞–º, —Ç–æ —ç—Ç–æ—Ç —á–µ—Ç—ã—Ä–µ—Ö—É–≥–æ–ª—å–Ω–∏–∫ ‚Äî ...",
                "answerOptions": [
                    { "text": "–¢—Ä–∞–ø–µ—Ü–∏—è", "isCorrect": false },
                    { "text": "–†–æ–º–±", "isCorrect": false },
                    { "text": "–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫", "isCorrect": false },
                    { "text": "–ü–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º", "isCorrect": true }
                ],
                "hint": "–≠—Ç–æ –∫–ª—é—á–µ–≤–æ–π –ø—Ä–∏–∑–Ω–∞–∫ –¥–ª—è —Ü–µ–ª–æ–≥–æ –∫–ª–∞—Å—Å–∞ —á–µ—Ç—ã—Ä–µ—Ö—É–≥–æ–ª—å–Ω–∏–∫–æ–≤."
            },
            {
                "questionNumber": 15,
                "questionType": "FREE_RESPONSE",
                "question": "–ü–µ—Ä–∏–º–µ—Ç—Ä –ø–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º–∞ —Ä–∞–≤–µ–Ω 36 —Å–º. –û–¥–Ω–∞ –∏–∑ –µ–≥–æ —Å—Ç–æ—Ä–æ–Ω –Ω–∞ 4 —Å–º –±–æ–ª—å—à–µ –¥—Ä—É–≥–æ–π. –ù–∞–π–¥–∏—Ç–µ –º–µ–Ω—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É –ø–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º–∞ (–≤ —Å–º).",
                "correctAnswers": ["7"],
                "hint": "–ü–µ—Ä–∏–º–µ—Ç—Ä –ø–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º–∞ —Ä–∞–≤–µ–Ω $2(a+b)$. –ù–∞–π–¥–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞ —Å—É–º–º—É –¥–≤—É—Ö —Å–º–µ–∂–Ω—ã—Ö —Å—Ç–æ—Ä–æ–Ω.",
                "rationale": "–ü–æ–ª—É–ø–µ—Ä–∏–º–µ—Ç—Ä —Ä–∞–≤–µ–Ω $36/2=18$ —Å–º. –ï—Å–ª–∏ –º–µ–Ω—å—à–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ $x$, —Ç–æ –±–æ–ª—å—à–∞—è $x+4$. $x + (x+4) = 18 \\Rightarrow 2x = 14 \\Rightarrow x=7$ —Å–º."
            },
            {
                "questionNumber": 16,
                "questionType": "FREE_RESPONSE",
                "question": "–°—Ç–æ—Ä–æ–Ω–∞ —Ä–æ–º–±–∞ –æ–±—Ä–∞–∑—É–µ—Ç —Å –æ–¥–Ω–æ–π –∏–∑ –µ–≥–æ –¥–∏–∞–≥–æ–Ω–∞–ª–µ–π —É–≥–æ–ª 25¬∞. –ù–∞–π–¥–∏—Ç–µ –±–æ–ª—å—à–∏–π —É–≥–æ–ª —Ä–æ–º–±–∞ (–≤ –≥—Ä–∞–¥—É—Å–∞—Ö).",
                "correctAnswers": ["130"],
                "hint": "–í—Å–ø–æ–º–Ω–∏—Ç–µ, —á–µ–º —è–≤–ª—è—é—Ç—Å—è –¥–∏–∞–≥–æ–Ω–∞–ª–∏ –¥–ª—è —É–≥–ª–æ–≤ —Ä–æ–º–±–∞.",
                "rationale": "–î–∏–∞–≥–æ–Ω–∞–ª–∏ —Ä–æ–º–±–∞ —è–≤–ª—è—é—Ç—Å—è –±–∏—Å—Å–µ–∫—Ç—Ä–∏—Å–∞–º–∏ –µ–≥–æ —É–≥–ª–æ–≤, –ø–æ—ç—Ç–æ–º—É –º–µ–Ω—å—à–∏–π —É–≥–æ–ª —Ä–∞–≤–µ–Ω $2 \\times 25¬∞ = 50¬∞$. –°—É–º–º–∞ —Å–æ—Å–µ–¥–Ω–∏—Ö —É–≥–ª–æ–≤ –≤ —Ä–æ–º–±–µ 180¬∞, –ø–æ—ç—Ç–æ–º—É –±–æ–ª—å—à–∏–π —É–≥–æ–ª —Ä–∞–≤–µ–Ω $180¬∞ - 50¬∞ = 130¬∞$."
            },
            {
                "questionNumber": 17,
                "question": "–í —Ç—Ä–∞–ø–µ—Ü–∏–∏ ABCD (BC || AD) —É–≥–æ–ª A —Ä–∞–≤–µ–Ω $50¬∞$, –∞ —É–≥–æ–ª C —Ä–∞–≤–µ–Ω $110¬∞$. –ù–∞–π–¥–∏—Ç–µ —É–≥–æ–ª B –∏ —É–≥–æ–ª D.",
                "answerOptions": [
                    { "text": "$\\angle B=130¬∞, \\angle D=70¬∞$", "isCorrect": true },
                    { "text": "$\\angle B=70¬∞, \\angle D=130¬∞$", "isCorrect": false },
                    { "text": "$\\angle B=110¬∞, \\angle D=50¬∞$", "isCorrect": false },
                    { "text": "$\\angle B=50¬∞, \\angle D=110¬∞$", "isCorrect": false }
                ],
                "hint": "–°—É–º–º–∞ —É–≥–ª–æ–≤, –ø—Ä–∏–ª–µ–∂–∞—â–∏—Ö –∫ –±–æ–∫–æ–≤–æ–π —Å—Ç–æ—Ä–æ–Ω–µ —Ç—Ä–∞–ø–µ—Ü–∏–∏, —Ä–∞–≤–Ω–∞ $180¬∞$."
            },
            {
                "questionNumber": 18,
                "question": "–ï—Å–ª–∏ –≤ —á–µ—Ç—ã—Ä–µ—Ö—É–≥–æ–ª—å–Ω–∏–∫–µ –¥–≤–µ —Å—Ç–æ—Ä–æ–Ω—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã –∏ —Ä–∞–≤–Ω—ã, —Ç–æ —ç—Ç–æ—Ç —á–µ—Ç—ã—Ä–µ—Ö—É–≥–æ–ª—å–Ω–∏–∫ ‚Äî ...",
                "answerOptions": [
                    { "text": "–†–∞–≤–Ω–æ–±–µ–¥—Ä–µ–Ω–Ω–∞—è —Ç—Ä–∞–ø–µ—Ü–∏—è", "isCorrect": false },
                    { "text": "–ü–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º", "isCorrect": true },
                    { "text": "–†–æ–º–±", "isCorrect": false },
                    { "text": "–î–µ–ª—å—Ç–æ–∏–¥", "isCorrect": false }
                ],
                "hint": "–≠—Ç–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –ø—Ä–∏–∑–Ω–∞–∫, —á—Ç–æ–±—ã –¥–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É –∫–ª–∞—Å—Å—É —Ñ–∏–≥—É—Ä."
            },
            {
                "questionNumber": 19,
                "question": "–í—ã—Å–æ—Ç–∞ —Ä–æ–º–±–∞, –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω–∞—è –∏–∑ –≤–µ—Ä—à–∏–Ω—ã —Ç—É–ø–æ–≥–æ —É–≥–ª–∞, –¥–µ–ª–∏—Ç —Å—Ç–æ—Ä–æ–Ω—É –ø–æ–ø–æ–ª–∞–º. –ù–∞–π–¥–∏—Ç–µ —É–≥–ª—ã —Ä–æ–º–±–∞.",
                "answerOptions": [
                    { "text": "$45¬∞, 135¬∞$", "isCorrect": false },
                    { "text": "$30¬∞, 150¬∞$", "isCorrect": false },
                    { "text": "$60¬∞, 120¬∞$", "isCorrect": true },
                    { "text": "$90¬∞, 90¬∞$", "isCorrect": false }
                ],
                "hint": "–†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω—ã–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–π –≤—ã—Å–æ—Ç–æ–π. –ß—Ç–æ –º–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å –æ–± —É–≥–ª–µ, –µ—Å–ª–∏ –∫–∞—Ç–µ—Ç –≤–¥–≤–æ–µ –º–µ–Ω—å—à–µ –≥–∏–ø–æ—Ç–µ–Ω—É–∑—ã?"
            },
            {
                "questionNumber": 20,
                "questionType": "FREE_RESPONSE",
                "question": "–í –ø–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º–µ ABCD –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ –±–∏—Å—Å–µ–∫—Ç—Ä–∏—Å–∞ —É–≥–ª–∞ A, –∫–æ—Ç–æ—Ä–∞—è –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç —Å—Ç–æ—Ä–æ–Ω—É BC –≤ —Ç–æ—á–∫–µ K. –ù–∞–π–¥–∏—Ç–µ –¥–ª–∏–Ω—É –æ—Ç—Ä–µ–∑–∫–∞ KC, –µ—Å–ª–∏ AB = 7 —Å–º, –∞ BC = 10 —Å–º.",
                "correctAnswers": ["3"],
                "hint": "–ë–∏—Å—Å–µ–∫—Ç—Ä–∏—Å–∞ —É–≥–ª–∞ –≤ –ø–∞—Ä–∞–ª–ª–µ–ª–æ–≥—Ä–∞–º–º–µ –æ—Ç—Å–µ–∫–∞–µ—Ç –æ—Ç –Ω–µ–≥–æ —Ä–∞–≤–Ω–æ–±–µ–¥—Ä–µ–Ω–Ω—ã–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫.",
                "rationale": "–£–≥–ª—ã KAD –∏ BKA —Ä–∞–≤–Ω—ã –∫–∞–∫ –Ω–∞–∫—Ä–µ—Å—Ç –ª–µ–∂–∞—â–∏–µ –ø—Ä–∏ BC || AD –∏ —Å–µ–∫—É—â–µ–π AK. –¢–∞–∫ –∫–∞–∫ AK - –±–∏—Å—Å–µ–∫—Ç—Ä–∏—Å–∞, —Ç–æ $\\angle B A K = \\angle K A D$. –°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, $\\angle B A K = \\angle B K A$, –∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ ABK - —Ä–∞–≤–Ω–æ–±–µ–¥—Ä–µ–Ω–Ω—ã–π. –ó–Ω–∞—á–∏—Ç, BK = AB = 7 —Å–º. –¢–æ–≥–¥–∞ KC = BC - BK = 10 - 7 = 3 —Å–º."
            }
        ];
        
        // --- DOM Elements ---
        const startContainer = document.getElementById('start-container');
        const firstNameInput = document.getElementById('first-name');
        const lastNameInput = document.getElementById('last-name');
        const nameError = document.getElementById('name-error');
        const startBtn = document.getElementById('start-btn');
        
        const quizContainer = document.getElementById('quiz-container');
        const questionTextEl = document.getElementById('question-text');
        const answerArea = document.getElementById('answer-area');
        const nextBtn = document.getElementById('next-btn');
        const progressText = document.getElementById('progress-text');
        const progressBar = document.getElementById('progress-bar');
        const resultText = document.getElementById('result-text');
        const hintBox = document.getElementById('hint-box');
        const hintTextEl = document.getElementById('hint-text');
        const timerEl = document.getElementById('timer');

        const resultsContainer = document.getElementById('results-container');
        const userNameResult = document.getElementById('user-name-result');
        const scorePercentageEl = document.getElementById('score-percentage');
        const scoreText = document.getElementById('score-text');
        const gradeText = document.getElementById('grade-text');
        const resultMessage = document.getElementById('result-message');
        const restartBtn = document.getElementById('restart-btn');
        const resultCircle = document.getElementById('result-circle');
        const savingStatus = document.getElementById('saving-status');

        // --- State ---
        let currentQuestionIndex = 0;
        let score = 0;
        let firstName = '';
        let lastName = '';
        let timerInterval;
        let timeLeft;
        const totalTime = 25 * 60; // 25 minutes in seconds

        // --- Functions ---
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function startQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            nextBtn.classList.add('hidden');
            loadQuestion();
        }

        function startTimer() {
            timeLeft = totalTime;
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    showResults(true);
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            let seconds = timeLeft % 60;
            seconds = seconds < 10 ? '0' + seconds : seconds;
            timerEl.textContent = `${minutes}:${seconds}`;
            if (timeLeft <= 30 && timeLeft > 0) { 
                 timerEl.classList.add('text-red-500');
            } else {
                 timerEl.classList.remove('text-red-500');
            }
        }

        function loadQuestion() {
            resultText.textContent = '';
            resultText.classList.remove('bg-green-100', 'text-green-700', 'bg-red-100', 'text-red-700');
            hintBox.classList.add('hidden');
            nextBtn.classList.add('hidden');
            
            const currentQuestion = quizData[currentQuestionIndex];
            questionTextEl.innerHTML = currentQuestion.question;
            progressText.textContent = `–í–æ–ø—Ä–æ—Å ${currentQuestionIndex + 1} –∏–∑ ${quizData.length}`;
            progressBar.style.width = `${((currentQuestionIndex + 1) / quizData.length) * 100}%`;
            answerArea.innerHTML = '';

            if (currentQuestion.questionType === 'FREE_RESPONSE') {
                answerArea.classList.remove('md:grid-cols-2');
                answerArea.innerHTML = `
                    <div class="flex flex-col sm:flex-row gap-3 items-center justify-center">
                        <input type="text" id="free-response-input" class="w-full sm:w-auto flex-grow text-center text-lg border-2 border-slate-300 rounded-lg p-3 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç">
                        <button id="submit-btn" class="w-full sm:w-auto bg-slate-700 text-white font-bold py-3 px-6 rounded-lg hover:bg-slate-800 transition-colors">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
                    </div>
                `;
                const input = document.getElementById('free-response-input');
                const submitBtn = document.getElementById('submit-btn');
                
                submitBtn.addEventListener('click', checkFreeResponseAnswer);
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') checkFreeResponseAnswer();
                });

            } else {
                answerArea.classList.add('md:grid-cols-2');
                shuffleArray(currentQuestion.answerOptions);
                currentQuestion.answerOptions.forEach(option => {
                    const button = document.createElement('button');
                    button.innerHTML = option.text;
                    button.classList.add('w-full', 'text-left', 'p-4', 'border', 'border-slate-300', 'rounded-lg', 'hover:bg-slate-100', 'hover:border-blue-500', 'transition-colors', 'duration-200');
                    button.addEventListener('click', () => selectAnswer(button, option));
                    answerArea.appendChild(button);
                });
            }
            onKatexLoad();
        }

        function selectAnswer(button, option) {
            disableAnswers();
            if (option.isCorrect) {
                score++;
                button.classList.add('bg-green-100', 'border-green-500');
                resultText.textContent = '–ü—Ä–∞–≤–∏–ª—å–Ω–æ!';
                resultText.classList.add('bg-green-100', 'text-green-700');
            } else {
                button.classList.add('bg-red-100', 'border-red-500');
                resultText.textContent = '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!';
                resultText.classList.add('bg-red-100', 'text-red-700');
                const correctButton = Array.from(answerArea.children).find((btn, index) => {
                    const originalOption = quizData[currentQuestionIndex].answerOptions.find(o => o.text === btn.innerHTML);
                    return originalOption && originalOption.isCorrect;
                });
                if (correctButton) {
                    correctButton.classList.add('bg-green-100', 'border-green-500');
                }
            }
            nextBtn.classList.remove('hidden');
        }


        function checkFreeResponseAnswer() {
            const input = document.getElementById('free-response-input');
            const userAnswer = input.value.trim();
            if (userAnswer === '') return;
            disableAnswers();

            const currentQuestion = quizData[currentQuestionIndex];
            if (currentQuestion.correctAnswers.includes(userAnswer)) {
                score++;
                input.classList.add('bg-green-100', 'border-green-500');
                resultText.textContent = '–ü—Ä–∞–≤–∏–ª—å–Ω–æ!';
                resultText.classList.add('bg-green-100', 'text-green-700');
            } else {
                input.classList.add('bg-red-100', 'border-red-500');
                resultText.innerHTML = `–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! <br class="sm:hidden"> –í–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç: <strong>${currentQuestion.correctAnswers[0]}</strong>`;
                resultText.classList.add('bg-red-100', 'text-red-700');
            }
            onKatexLoad();
            nextBtn.classList.remove('hidden');
        }
        
        function disableAnswers() {
            Array.from(answerArea.children).forEach(child => {
                if (child.tagName === 'BUTTON') {
                    child.disabled = true;
                    child.classList.add('cursor-not-allowed');
                } else {
                    const input = child.querySelector('input');
                    const btn = child.querySelector('button');
                    if(input) input.disabled = true;
                    if(btn) btn.disabled = true;
                }
            });

            const currentQuestion = quizData[currentQuestionIndex];
            if (currentQuestion.hint) {
                hintTextEl.textContent = currentQuestion.hint;
                hintBox.classList.remove('hidden');
            }
        }
        
        async function sendResultsToGoogleSheet(resultData) {
            if (!GOOGLE_SCRIPT_URL || GOOGLE_SCRIPT_URL === '') {
                console.warn('Google Script URL is not specified. Results will not be saved.');
                savingStatus.textContent = 'URL –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω.';
                savingStatus.classList.add('text-yellow-600');
                return;
            }
            
            savingStatus.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...';
            savingStatus.classList.remove('text-green-600', 'text-red-600', 'text-yellow-600');

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8',
                    },
                    body: JSON.stringify(resultData)
                });

                const result = await response.json();
                
                if (result.status === 'success') {
                    console.log('Results sent successfully');
                    savingStatus.textContent = '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!';
                    savingStatus.classList.add('text-green-600');
                } else {
                    console.error('Error from script:', result.message);
                    savingStatus.textContent = '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞).';
                    savingStatus.classList.add('text-red-600');
                }
            } catch (error) {
                 console.error('Network error while sending results:', error);
                 savingStatus.textContent = '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–æ—à–∏–±–∫–∞ —Å–µ—Ç–∏).';
                 savingStatus.classList.add('text-red-600');
            }
        }


        function showResults(isTimeUp = false) {
            quizContainer.classList.add('hidden');
            resultsContainer.classList.remove('hidden');
            restartBtn.classList.remove('hidden');
            
            userNameResult.textContent = `–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è: ${firstName} ${lastName}`;
            scoreText.textContent = `${score}/${quizData.length}`;

            const percentage = Math.round((score / quizData.length) * 100);
            scorePercentageEl.textContent = `${percentage}%`;
            resultCircle.style.strokeDasharray = `${percentage}, 100`;

            let grade = 2;
            let gradeColor = 'text-red-500';

            if(isTimeUp) {
                resultMessage.textContent = "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤—Ä–µ–º—è –≤—ã—à–ª–æ.";
            } else {
                if (percentage >= 90) { // 18-20 correct
                    grade = 5;
                    gradeColor = 'text-green-500';
                    resultMessage.textContent = "–û—Ç–ª–∏—á–Ω–æ! –í—ã –Ω–∞—Å—Ç–æ—è—â–∏–π –∑–Ω–∞—Ç–æ–∫ –≥–µ–æ–º–µ—Ç—Ä–∏–∏!";
                } else if (percentage >= 75) { // 15-17 correct
                    grade = 4;
                    gradeColor = 'text-blue-600';
                    resultMessage.textContent = "–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –í—ã —Ö–æ—Ä–æ—à–æ –∑–Ω–∞–µ—Ç–µ —Ç–µ–º—É.";
                } else if (percentage >= 50) { // 10-14 correct
                    grade = 3;
                    gradeColor = 'text-yellow-500';
                     resultMessage.textContent = "–ù–µ–ø–ª–æ—Ö–æ, –Ω–æ —Å—Ç–æ–∏—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–º–µ–Ω—Ç—ã.";
                } else {
                     resultMessage.textContent = "–ù—É–∂–Ω–æ –µ—â–µ –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ —ç—Ç–æ–π —Ç–µ–º–æ–π.";
                }
            }
            
            if (grade > 2) {
                restartBtn.classList.add('hidden');
            }

            gradeText.textContent = grade;
            gradeText.className = `text-2xl sm:text-3xl font-bold ${gradeColor}`;
            resultCircle.className = `stroke-current ${gradeColor} transition-all duration-1000`;
            
            const resultData = {
                firstName: firstName,
                lastName: lastName,
                score: score,
                totalQuestions: quizData.length,
                percentage: percentage,
                grade: grade
            };

            sendResultsToGoogleSheet(resultData);
        }

        // --- Event Listeners ---
        startBtn.addEventListener('click', () => {
            firstName = firstNameInput.value.trim();
            lastName = lastNameInput.value.trim();
            if (firstName === '' || lastName === '') {
                nameError.classList.remove('hidden');
            } else {
                nameError.classList.add('hidden');
                startContainer.classList.add('hidden');
                quizContainer.classList.remove('hidden');
                shuffleArray(quizData);
                startTimer();
                startQuiz();
            }
        });

        nextBtn.addEventListener('click', () => {
            currentQuestionIndex++;
            if (currentQuestionIndex < quizData.length) {
                loadQuestion();
            } else {
                clearInterval(timerInterval);
                showResults();
            }
        });

        restartBtn.addEventListener('click', () => {
            clearInterval(timerInterval);
            resultsContainer.classList.add('hidden');
            startContainer.classList.remove('hidden');
            firstNameInput.value = '';
            lastNameInput.value = '';
        });
        
        onKatexLoad();
    });
</script>

</body>
</html>

